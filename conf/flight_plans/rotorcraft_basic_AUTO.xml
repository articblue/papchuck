<!DOCTYPE flight_plan SYSTEM "flight_plan.dtd">

<flight_plan alt="152" ground_alt="147" lat0="37 15 26.625" lon0="-80 27 58.4532" max_dist_from_home="25" name="Rotorcraft Basic (Enac)" security_height="5">
  <header>
#include "autopilot.h"
  </header>

  <waypoints>
    <waypoint name="HOME" x="0.0" y="0.0"/>
    <waypoint name="CLIMB" x="0.0" y="0.0"/>
    <waypoint name="STDBY" x="0.0" y="0.0"/>
    <waypoint name="p1" x="5.0" y="5.0"/>
    <waypoint name="p2" x="-5.0" y="5.0"/>
    <waypoint name="p3" x="-5.0" y="-5.0"/>
    <waypoint name="p4" x="5.0" y="-5.0"/>
    <waypoint name="TD" x="0.0" y="0.0"/>
  </waypoints>

  <exceptions>
    <exception cond="And(block_time>20, dist2_to_home > 50.*50.)" deroute="HOME"/>
    <exception cond="And(block_time>20, dist2_to_home > 60.*60.)" deroute="kill"/>
  </exceptions>

  <blocks>

    <block name="kill">
      <go wp="HOME" vmode="throttle" throttle="0" pitch="0"/>
    </block>
 <block name="Wait GPS">
      <call fun="NavKillThrottle()"/>
      <while cond="!GpsFixValid()"/>
    </block>
    <block name="Geo init">
      <while cond="LessThan(NavBlockTime(), 10)"/>
      <call fun="NavSetGroundReferenceHere()"/>
      <!--<call fun="NavSetAltitudeReferenceHere()"/>-->
    </block>
    <block name="Takeoff" strip_button="Takeoff" strip_icon="takeoff.png">
      <call fun="NavResurrect()"/>
      <exception cond="stateGetPositionEnu_f()->z > 25.0" deroute="circlehome"/>
      <call fun="NavSetWaypointHere(WP_CLIMB)"/>
      <stay vmode="climb" climb="1.0" wp="CLIMB"/>
    </block>

    <block name="circlehome">
      <circle wp="HOME" radius="5"/>
    </block>

  </blocks>
</flight_plan>
